@model IEnumerable<hackaton_asp_project.Models.AdUserCreated>

@{
    ViewData["Title"] = "Все объявления";
}

<h1>Все объявления</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Добавить новое объявление</a>
</p>

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Тип недвижимости</th>
                    <th>Город</th>
                    <th>Район</th>
                    <th>Городской район</th>
                    <th>Микрорайон</th>
                    <th>Улица</th>
                    <th>Площадь (кв.м)</th>
                    <th>Стоимость</th>
                    <th>Комнаты</th>
                    <th>Этаж</th>
                    <th>Описание</th>
                    <th>Фотографии</th>
                    <th>Владелец</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ad in Model)
                {
                    <tr class="@(ViewBag.CurrentUserId != null && ad.UserId == ViewBag.CurrentUserId ? "table-success" : "")">
                        <td>@(ad.Type?.type_name ?? "Не указан")</td>
                        <td>@(ad.City?.city_name ?? "Не указан")</td>
                        <td>@(ad.District?.district_name ?? "-")</td>
                        <td>@(ad.CityDistrict?.city_district_name ?? "-")</td>
                        <td>@(ad.Microdistrict?.microdistrict_name ?? "-")</td>
                        <td>@(ad.Street?.street_name ?? "-")</td>
                        <td>@(ad.AreaObj?.ToString("F2") ?? "-")</td>
                        <td>@(ad.Cost?.ToString("C") ?? "-")</td>
                        <td>@ad.CountOfRooms</td>
                        <td>@ad.Stage</td>
                        <td>@(string.IsNullOrEmpty(ad.Description) ? "-" : ad.Description)</td>
                        <td>
                            @if (!string.IsNullOrEmpty(ad.ImageUrls))
                            {
                                var images = ad.ImageUrls.Split(',', StringSplitOptions.RemoveEmptyEntries);
                                @foreach (var image in images)
                                {
                                    <img src="@image.Trim()" alt="Фото объявления" class="img-thumbnail" style="max-width: 80px; margin: 3px;" />
                                }
                            }
                            else
                            {
                                <span>Нет фото</span>
                            }
                        </td>
                        <td>
                            @(ViewBag.CurrentUserId != null && ad.UserId == ViewBag.CurrentUserId ? "Моё" : (ad.Users?.Email ?? "Неизвестный пользователь"))
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <p class="text-muted">Объявления отсутствуют. Добавьте новое объявление, чтобы начать!</p>
}

@section Scripts {
    <script>
        // Additional JavaScript, if needed (e.g., for table interactivity)
    </script>
}